<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ê¸¸ì¹˜ë¥¼ ìœ„í•œ ë‚´ë¹„ê²Œì´ì…˜</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
        }

        #map {
            width: 100%;
            height: 100vh;
        }

        #guide-overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
            z-index: 10;
            font-weight: bold;
            background: rgba(23, 31, 251, 0.7);
        }

        #start-btn {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            background: #23d166;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            z-index: 20;
        }
    </style>
</head>

<body>

    <div id="guide-overlay">ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”! ğŸ˜Š</div>
    <button id="start-btn">ê¸¸ ì°¾ê¸° ì‹œì‘ (ì§„ë™/ìŒì„± í™œì„±í™”)</button>
    <div id="map"></div>

    <!--<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=98f0f8824a53dacd88d4bdff4e621cc8"></script>-->
    <script type="text/javascript"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=98f0f8824a53dacd88d4bdff4e621cc8"></script>


    <script>
        const guide = document.getElementById('guide-overlay');
        const targetPos = new kakao.maps.LatLng(37.5615, 127.0033); // ëª©ì ì§€ (íƒœê·¹ë‹¹)
        let map, myMarker, polyline, myLocation = null;

        // 1. ê°€ì´ë“œ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ë¬¸êµ¬ì™€ ìƒ‰ìƒ ë³€ê²½)
        function showGuide(text, color) {
            guide.innerHTML = `<strong>"${text}"</strong>`;
            guide.style.backgroundColor = color;
        }

        // 2. ë‘ ì§€ì  ì‚¬ì´ì˜ ë°©ìœ„ê° ê³„ì‚° (ìˆ˜í•™ ê³µì‹)
        function getBearing(p1, p2) {
            const lat1 = p1.getLat() * Math.PI / 180, lat2 = p2.getLat() * Math.PI / 180;
            const lon1 = p1.getLng() * Math.PI / 180, lon2 = p2.getLng() * Math.PI / 180;
            const y = Math.sin(lon2 - lon1) * Math.cos(lat2);
            const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(lon2 - lon1);
            return (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;
        }

        // 3. ì‹¤ì‹œê°„ ë°©í–¥ ì²´í¬ ë° ì§„ë™/ë©”ì‹œì§€ ì²˜ë¦¬
        function updateDirection(heading) {
            if (!myLocation) return;

            const targetBearing = getBearing(myLocation, targetPos);
            const diff = (targetBearing - heading + 360) % 360;

            if (diff < 25 || diff > 335) {
                showGuide("ì§€ê¸ˆ ë°©í–¥ìœ¼ë¡œ ì­‰ ê°€ì„¸ìš”", "rgba(46, 204, 113, 0.9)");
                if (navigator.vibrate) navigator.vibrate(200); // ì •ë°©í–¥ì¼ ë•Œ ì§„ë™
            } else {
                const turn = (diff < 180) ? "ì˜¤ë¥¸ìª½" : "ì™¼ìª½";
                showGuide(`ë°©í–¥ì´ í‹€ë ¸ìŠµë‹ˆë‹¤. ${turn}ìœ¼ë¡œ ê°€ì„¸ìš”`, "rgba(230, 126, 34, 0.9)");
            }
        }

        // 4. ì§€ë„ ë° ìœ„ì¹˜ ì¶”ì  ì‹œì‘
        function startTracking() {
            navigator.geolocation.watchPosition(pos => {
                const lat = pos.coords.latitude, lon = pos.coords.longitude;
                myLocation = new kakao.maps.LatLng(lat, lon);

                if (!map) { // ì§€ë„ ì´ˆê¸°í™”
                    map = new kakao.maps.Map(document.getElementById('map'), { center: myLocation, level: 3 });
                    myMarker = new kakao.maps.Marker({ map: map });
                    new kakao.maps.Marker({ position: targetPos, map: map, title: "ëª©ì ì§€" });
                    polyline = new kakao.maps.Polyline({ map: map, strokeWeight: 8, strokeColor: '#FF0000', strokeOpacity: 0.8 });
                }

                myMarker.setPosition(myLocation);
                map.setCenter(myLocation);
                polyline.setPath([myLocation, targetPos]);
            });
        }

        // 5. ë²„íŠ¼ í´ë¦­ ì‹œ ë‚´ë¹„ê²Œì´ì…˜ ì‹œì‘
        document.getElementById('start-btn').addEventListener('click', function () {
            this.style.display = 'none';
            startTracking();

            // ìŒì„± ì•ˆë‚´
            const speech = new SpeechSynthesisUtterance("ë‚´ë¹„ê²Œì´ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì§„ë™ì´ ìš¸ë¦¬ëŠ” ë°©í–¥ìœ¼ë¡œ ê±¸ì–´ê°€ì„¸ìš”.");
            window.speechSynthesis.speak(speech);

            // ê¸°ê¸° ë°©í–¥ ì„¼ì„œ ì‘ë™ (iOS ëŒ€ì‘ í¬í•¨)
            const handleOrientation = (e) => updateDirection(e.webkitCompassHeading || e.alpha);

            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(state => {
                    if (state === 'granted') window.addEventListener('deviceorientation', handleOrientation);
                });
            } else {
                window.addEventListener('deviceorientation', handleOrientation);
            }
        });
    </script>
</body>

</html>